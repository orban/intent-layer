# DRAFT - Review and curate before use
# Generated from: https://github.com/ansible/ansible
# Tasks found: 10 (focused on bug fixes with unit tests in test/units/)
#
# NOTE: Ansible requires Python 3.12+. The unit test suite runs via pytest.
# Many ansible PRs only have integration tests (ansible-playbook based),
# which can't run in our Docker harness. We prioritize PRs that include
# changes to test/units/ files.

repo:
  url: https://github.com/ansible/ansible
  default_branch: devel
  docker:
    image: python:3.12-slim
    setup:
    - apt-get update && apt-get install -y git
    - pip install --upgrade pip
    - pip install -e .
    - pip install pytest pytest-mock passlib bcrypt pexpect pywinrm
    test_command: pytest --tb=short -q
  strip_extra:
  - .claude/
  - .cursor/
  - .codex/
tasks:
# --- PRs with unit tests (pytest) ---

- id: fix-clearlinux-gentoo-os-release-parsing
  category: simple_fix
  difficulty: medium
  pre_fix_commit: 28927a70b43a43ecd99d5926ef7860cd6a35d12e
  fix_commit: 869088b959408b72ea04905f40c2e284bd232d56
  prompt_source: failing_test
  _commit_message: 'Fixes Parsing for ClearLinux exposed by Gentoo (#86384)'
  _lines_changed: 55
  _files_changed: 3
  test_file: test/units/module_utils/facts/system/distribution/
  issue_number: 86384
  # Fix: ClearLinux parser returned partial data for non-ClearLinux distros.
  # Added else: return False when NAME regex doesn't match, plus strip both quote types.
  # New unit test fixture: gentoo.json

- id: fix-get-url-regex-for-gnu-digest-line
  category: targeted_refactor
  difficulty: hard
  pre_fix_commit: e2ae13cf3889099932025347abc2f1b5ef86987d
  fix_commit: af9009b00da0e473ccf128710e681482c896f6b6
  prompt_source: failing_test
  _commit_message: 'get_url: Fix regex for GNU digest line (#86134)'
  _lines_changed: 158
  _files_changed: 4
  test_file: test/units/modules/test_get_url.py
  issue_number: 86134
  # Fix: GNU_DIGEST_LINE regex didn't handle multiple spaces, dot-slash, or asterisk prefixes.
  # New parametrized test cases added to test_parse_digest_lines.

- id: fix-ansiblemodule-human-to-bytes
  category: simple_fix
  difficulty: medium
  pre_fix_commit: 222f786f233f6e32024f4b8c148ec2121f03edfa
  fix_commit: 13a7393cfe982fab7cb6dbaf43e12879160afbc2
  prompt_source: failing_test
  _commit_message: 'Fix AnsibleModule.human_to_bytes (#85259)'
  _lines_changed: 46
  _files_changed: 4
  test_file: test/units/module_utils/basic/test_human_to_bytes.py
  issue_number: 85259
  # Fix: AnsibleModule.human_to_bytes() wrapper didn't pass isbits as keyword arg,
  # breaking the standalone human_to_bytes() which added a default_unit parameter.
  # Entirely new test file added.

- id: inventory-add-warning-invalid-priority-values
  category: targeted_refactor
  difficulty: medium
  pre_fix_commit: f743dfce93ea6a4c78aee92831fd2e3b63efe335
  fix_commit: 3c3a06b8fd6dc0aa94743e6386d2f4ddc7b6bd71
  prompt_source: failing_test
  _commit_message: 'inventory: Add warning for invalid priority values (#86114)'
  _lines_changed: 336
  _files_changed: 3
  test_file: test/units/inventory/test_group.py
  issue_number: 86114
  # Fix: Group.set_priority() silently swallowed TypeError, now also catches ValueError
  # and emits a warning. Existing unittest.TestCase refactored to pytest functions.
  # New parametrized tests for valid and invalid priority values.

- id: fix-v1-source-info-schema-validation
  category: targeted_refactor
  difficulty: medium
  pre_fix_commit: 7726bf61a8da2f354aa88ca9de201bcba0651330
  fix_commit: 612d54fc6f8bbdc50d6f242232ab2cc6c46640ac
  prompt_source: failing_test
  _commit_message: 'Fix argument spec for v1 source info schema validation (#86320)'
  _lines_changed: 184
  _files_changed: 3
  test_file: test/units/galaxy/test_collection_dataclasses.py
  issue_number: 86320
  # Fix: signatures field used type=list with suboptions (invalid), changed to
  # type="list", elements="dict", options=dict(...). 176 lines of new unit tests added.

- id: fix-iptables-match-extension-bug
  category: simple_fix
  difficulty: medium
  pre_fix_commit: 13a7393cfe982fab7cb6dbaf43e12879160afbc2
  fix_commit: e0f61dfce445241bb3bea7606dd84096ad3c1149
  prompt_source: commit_message
  _commit_message: 'Fix iptables match extension bug (#86147)'
  _lines_changed: 45
  _files_changed: 3
  issue_number: 86147
  # Fix: iptables module duplicated -m extensions when match arg overlapped with
  # auto-imported extensions (uid_owner, etc.). Added loaded_extensions set tracking.
  # Tests are integration-only (ansible playbooks), no unit test changes.

- id: fix-local-connection-become-bytearray
  category: simple_fix
  difficulty: medium
  pre_fix_commit: 29086acfa61f32a9e5b087abdaf4336330ab5456
  fix_commit: 90595736ed35a88e63b6c680d6a1daa38a2ccce1
  prompt_source: failing_test
  _commit_message: 'Fix local connection interaction with become plugins (#86473)'
  _lines_changed: 54
  _files_changed: 6
  test_file: test/units/plugins/become/test_su.py
  issue_number: 86473
  # Fix: local connection plugin passed bytearray to become plugin methods
  # that expect bytes. Changed to bytes(). Unit test updated to pass b'' instead of ''.

- id: callback-filter-ansible-prefix-in-debug
  category: simple_fix
  difficulty: medium
  pre_fix_commit: 52cd605887e592a906d316eb11d6507b5100b36c
  fix_commit: cc9e71f4118b2b55e5f33df22422e99621a60848
  prompt_source: commit_message
  _commit_message: 'callback: filter _ansible_ in debug message (#84594)'
  _lines_changed: 68
  _files_changed: 13
  issue_number: 84594
  # Fix: _clean_results filtered all keys starting with '_', but should only
  # filter keys starting with '_ansible_'. One-char change in callback __init__.py.
  # Tests are integration-only (callback output comparison files).

- id: action-make-tmp-path-fix-error-message
  category: simple_fix
  difficulty: easy
  pre_fix_commit: 90595736ed35a88e63b6c680d6a1daa38a2ccce1
  fix_commit: 2c1fdfe0eba4505251c50a0a7f3596641e966007
  prompt_source: commit_message
  _commit_message: 'Action make_tmp_path fix error (#86505)'
  _lines_changed: 8
  _files_changed: 2
  # Fix: error message included dataclass repr instead of just the command string.
  # Changed cmd to cmd.command in format string. No unit test changes.

- id: config-lookup-fallback-to-existing-constants
  category: simple_fix
  difficulty: medium
  pre_fix_commit: be09a21446e34ccce341b49e69cc674c2d9049ac
  fix_commit: 8730acbb2db944de118cae0e6bdac053a2f33362
  prompt_source: commit_message
  _commit_message: 'config lookup, fallback to existing constants when needed (#86516)'
  _lines_changed: 25
  _files_changed: 4
  issue_number: 86516
  # Fix: config lookup plugin only used task vars for templating, but some config
  # values reference other constants (like ANSIBLE_HOME). Added ChainMap fallback.
  # Tests are integration-only.
