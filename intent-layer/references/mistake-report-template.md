# Mistake Report Template

Use this format to capture mistakes for Intent Layer improvement. Reports are generated by `scripts/capture_mistake.sh` or created manually.

## Storage Location

```
project-root/
├── .intent-layer/
│   └── mistakes/
│       ├── pending/         ← New reports awaiting review
│       ├── accepted/        ← Converted to checks/pitfalls
│       └── rejected/        ← Not actionable (kept for reference)
```

## Report Format

```markdown
## Mistake Report

**ID**: MISTAKE-YYYY-MM-DD-NNN
**Timestamp**: YYYY-MM-DDTHH:MM:SSZ
**Directory**: [path where mistake occurred]
**Operation**: [what agent was trying to do]

### What Happened
[Description of the mistake - what went wrong]

### How Discovered
- [ ] Tests failed
- [ ] User corrected
- [ ] Agent self-caught
- [ ] Incident/production issue

### Root Cause
[Why it happened - what knowledge was missing]

### Intent Layer Gap
- **Existing node**: [path to AGENTS.md if exists, or "None"]
- **Missing content**: [what was not documented]

### Suggested Fix
<!-- Pick one or both -->

**As Pre-flight Check**:
```markdown
### [Operation Name]
Before [triggering action]:
- [ ] [Verifiable check]

If unchecked → [ask/fix first/stop and escalate].
```

**As Pitfall** (if check not appropriate):
```markdown
- [Awareness-only item]
```

### Disposition
<!-- Filled during review -->
- [ ] Check added to AGENTS.md
- [ ] Pitfall added to AGENTS.md
- [ ] Rejected (reason: _______)
- [ ] Deferred (reason: _______)
```

## Review Workflow

### Accept
Finding is accurate → Update the Intent Node:
1. Add check or pitfall to appropriate AGENTS.md
2. Move report to `accepted/`
3. Commit both changes together

### Reject
Finding is incorrect → Document why:
1. Add rejection reason to Disposition
2. Move report to `rejected/`
3. Rejection reasons help calibrate future captures

### Defer
Finding needs investigation:
1. Add deferral reason to Disposition
2. Keep in `pending/` with review note
3. Revisit during next maintenance cycle

## Review Cadence

| Approach | When | Good For |
|----------|------|----------|
| **Immediate** | After each capture | Small teams, critical areas |
| **Batched** | Weekly/sprint review | Larger teams, steady flow |
| **Threshold** | When pending/ hits N reports | Variable activity |

## Example Report

```markdown
## Mistake Report

**ID**: MISTAKE-2026-01-22-001
**Timestamp**: 2026-01-22T10:30:00Z
**Directory**: src/auth/
**Operation**: Adding new API endpoint

### What Happened
Modified `handlers/login.ts` to add new endpoint without updating `config/rate_limits.yaml`. Rate limiting didn't apply to new endpoint.

### How Discovered
- [x] Tests failed
- [ ] User corrected
- [ ] Agent self-caught
- [ ] Incident/production issue

### Root Cause
Didn't know rate limit config needed an entry for each endpoint. No documentation mentioned this dependency.

### Intent Layer Gap
- **Existing node**: `src/auth/AGENTS.md`
- **Missing content**: No mention of rate_limits.yaml dependency for new endpoints

### Suggested Fix

**As Pre-flight Check**:
```markdown
### Adding Endpoints
Before adding a new endpoint:
- [ ] `config/rate_limits.yaml` has entry for the route

If unchecked → add entry before proceeding.
```

### Disposition
- [x] Check added to AGENTS.md
- [ ] Pitfall added to AGENTS.md
- [ ] Rejected (reason: _______)
- [ ] Deferred (reason: _______)
```
